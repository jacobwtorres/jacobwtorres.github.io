<!DOCTYPE HTML>
<html>

<!-- <link rel="stylesheet" type="text/css" href="style.css"> -->

<style>
    html, body {
        height: 100%;
    }

    iframe {
        display: block;
        background: #FFF;
        border: none;
        width: 100%;
        height: 100%;
    }

    input:focus, textarea:focus, select:focus{
        outline: none;
    }

        /* chrome scrollbars */
    textarea::-webkit-scrollbar
    {
        width: 16px;
        background-color: #444;
        cursor: pointer;
    }
    textarea::-webkit-scrollbar-track
    {
        background-color: #333;
        cursor: pointer;
    }
    textarea::-webkit-scrollbar-corner
    {
      background-color: #484;
      -webkit-box-shadow: inset 0 0 6px rgba(255,255,255,0.3);
    }
    textarea::-webkit-scrollbar-thumb
    {
      background-color: #444;
      /*outline: 1px solid #666;*/
      -webkit-box-shadow: inset 0 0 6px rgba(255,255,255,0.3);
      cursor: pointer;
    }
</style>


<body onload="init()" style="overflow:hidden;" bgcolor="#333">
    <script>
		let THISURL = location.protocol + '//' + location.host + location.pathname;//'https://jacobwtorres.github.io/'
		console.log(location.protocol + '//' + location.host + location.pathname)
		let dbox_key_value = '';	
		let dbox_account_id = '';	
		let CLIENT_ID = 'p4p60gowtlk2vl9';
		// var CALLBACK_URL = 'https://'+chrome.runtime.id+'.chromiumapp.org';
		let AUTH_URL = 'https://www.dropbox.com/oauth2/authorize?client_id=' + CLIENT_ID + '&response_type=token' + '&redirect_uri=' + THISURL;
		
		let BMARK_PATH = "/Bookmarks/";
		let NOTE_PATH = "/Notes/";
		let INTERNAL_PATH = "/.internal/";
		
		let current_note_path = "";
		let already_saved = 0;
		let full_path_to_write = "";
		
		var timer;
		
		function makeid(length) {
		   var result           = '';
		   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
		   var charactersLength = characters.length;
		   for ( var i = 0; i < length; i++ ) {
		      result += characters.charAt(Math.floor(Math.random() * charactersLength));
		   }
		   return result;
		}
		
		//add ability to share file with other user in realtime. Is this possible w/o dropbox?
		
		//every files cache needs metadata about whether we have already prompted the uer
		//dbox timestamp of last change when we opened it
		//already prompted to reopen with no?
		//encrypted?
		
		//different page args.
		//if arg==open with valid file name (is allowed to be path to cached file with no regular path!!!)
			//hardcode title into box and disable input
			//check for existing file lock, cache, metadata
			//if exists
				//that file is already open with unsaved changes, would you like to load them or the original?
				//if load
					//load from dbox, return
				//else
					//are you sure you would like to erase unbacked local changes?
			//else
				//it adds a remote cache of the file and grabs the timestamp
		
			//before you click save, check to see if timestampt has changed. If yes, inform the user you may be overwriting changes since someone has saved in the mean time
		//else
			//consider it a new file
			//check cache
				//if cache found and haven't hasked before about these specific changes
					//prompt user to load all available caches
				//else
					///populate button to load available caches
			//allow normal input
		
		//open button
		//popup list of files to choose from
		//if file is not .txt, check if they want to open in dropbox.com
		//ask if they want to open here or nvaigate to new tab
		//if open here
			//walk through full close procedure 
				//do you want this tab with contents to reopen?
				//if no
		//confirm: all unpushed changes are going to be wiped and this tab will not reopen
		//if confirm
			//go to open page
		
		//when you click new, allow title to be entered, and create dummy random name with remote cache and random id as open file
		//If no name entered, use prompt()
		//check for existing file
			//if name exists, confirm they want to overwrite
		//save and check success
		//save new cache under proper name, delete old cache
		//after saving, navigate to 'open' page of same file (which loads from remote and give option to load from cache) 
		
		//premium
		//enable client side encryption after 'open' functionality
		//search functionaluty in new page - also search caches
		 
		//anytime you exit, would you like this tab to reopen the next time you visit us?
		//prompt on open: We found other open files, would you like to open them now?
		//search local
		//serach remote
		
		//side bar showing ls of whole directory
		//clickable elements with options: open here, open in new tab
		
		//Load new File button instead of open
		//option to do it in a new tab or 
		
		//code for directory change being possible, but disable
		
		//add icon
		//change marcador client ID and logo
		
		//new load function that will perform option decryption if it finds appropriate header
		//in every encrypted file add comments at the top for dow to decrypt in CLI in case our service ever goes down
		//add opion to partially encrypt via ML in text??
		//prompt user password everytime
		
		//close page handler
		//ensure everything is saved to cache!!!
		//ask user if they want this to come up the next time?
		
		//add last cached timer
		
		//add logged in as 
		
		//add check user paid callbacks
		
		//add open in dropbox button
		
		//Add directory path hardcoded before file name?
		
		//create all necessary folder names!!
		
		//we want to also cache things locally right??? Data saved at any cost
	    window.onbeforeunload = function(e) {
			console.log("Do other stuff");
			alert("DO tis now!");
	       return 'This tab will reopen the next time if you do not ';
	    };
		
		function save_loop()
		{			
			
			let di = document.getElementById('di');
			let ti = document.getElementById('ti');
			let lo = document.getElementById('log');
			var timeout = 60000;
			
			if(ta.value == "")
			{
				console.log("Skip cache. Empty");
				return;
			}
			
			//TODO name change detect and reload page without recalling this function
			
			console.log("Cache now!!!");
			
			if(lo.value == "Logout")
			{
				//we are logged in, use remote cache
				// cache_current_file({
					
				// });
			}
			else
			{
				//we are not logged in, use local cache
				localStorage.setItem("ta.value", ta.value);
				localStorage.setItem("ti.value", ti.value);
				localStorage.setItem("di.value", di.value);
				timeout = 5000;
			}
			
			clearTimeout(timer);
			timer = setTimeout(save_loop, timeout);
		}
		
		function reload_site_as(site)
		{
			save_loop();
			window.location.href = site;
		}
		
		function open_new_site_as(url)
		{
		    var win = window.open(url, '_blank');
		    win.focus();
		}
		
		function erase()
		{
			if(confirm("Press OK to confirm you would like to Erase this file."))
			{
				window.localStorage.removeItem("ta.value")
				window.localStorage.removeItem("ti.value")
				window.localStorage.removeItem("di.value")
			
				ta.value = '';
				ti.value = '';
			}
		}
		
		// document.onload = function()
		function init()
		{
			console.log("Save loop init");
				
				
			//are we open with no params?
			    //immediately redirect to new note with random name
			
			//check for open in URL
			//check for cache of file
			//if cche, load it, else load main file and create appropriate meta
			
			//check for caches other than open file
			//if cached exists and  
					
			let di = document.getElementById('di');
			let ti = document.getElementById('ti');
			let lo = document.getElementById('log');
			
			
			ta.value = window.localStorage.getItem("ta.value")
			ti.value = window.localStorage.getItem("ti.value")
			di.value = window.localStorage.getItem("di.value")
			
			
		
			// save_loop();
			
			var queryString = new URL(window.location.href.replace(/#/g,"?"));
			console.log("queryString= " + queryString);
		
			if(queryString != "")
			{
				console.log("Checking for token");
				// window.location.href = AUTH_URL;
				access_token = queryString.searchParams.get("access_token");
				console.log("Found New token: " + access_token);
				
				account_id = queryString.searchParams.get("account_id");
				console.log("Found New Account ID: " + account_id);
				
				open_file = queryString.searchParams.get("open");
				console.log("Found Open file: " + open_file);

				//THIS SECTION IS ONLY HIT DURING ACTIVE LOGIN, NOT FOR LOGGED IN STATUS
				if(access_token != null && account_id != null)
				{			
					dbox_key_value = access_token;
					dbox_account_id = account_id;
					
					localStorage.setItem("dbox_token", dbox_key_value);
					localStorage.setItem("dbox_account_id", dbox_account_id);
					
					dbox_key_check(function(ret){
						if(ret == 200)
						{
							console.log("Key worked");
							// localStorage.setItem("dbox_token", dbox_key_value);
							// localStorage.setItem("dbox_account_id", dbox_account_id);
							// dbox_create_folder(BMARK_PATH); //these might not ever get hit
							// dbox_create_folder(NOTE_PATH);
							reload_site_as(THISURL);
						}
						else
						{
							console.log("Key NOT working");
							alert(	"We're sorry, but that Login to Dropbox failed. The token returned to us did not check out. To be safe we are logging you out of all accounts.");
							localStorage.removeItem("dbox_token");
							localStorage.removeItem("dbox_account_id");
							reload_site_as(THISURL);
						}
					
					})
	
					return;
				}
				else if(open_file != null)
				{
					ti.value = open_file;
				}
				else
				{
					reload_site_as(THISURL+"?open=.Untitled_"+makeid(9));
				}
			}
			
			
			console.log("Token=")
			console.log(localStorage.getItem("dbox_token"))
			
			//load in dbx credentials
			if (localStorage.getItem("dbox_token") == '')
			{
				console.log("Key NOT found in storage");
			  	//TODO populate Login to Dropbox button
				let pu = document.getElementById('push');
				pu.style.visibility = 'hidden';
				
				let lo = document.getElementById('log');
				lo.value = 'Login to Dropbox';
			}
			else
			{
				let lo = document.getElementById('log');
				let pu = document.getElementById('push');
				
				console.log("Key FOUND in storage");
				
				dbox_key_value = localStorage.getItem("dbox_token");
				dbox_account_id = localStorage.getItem("dbox_account_id");
				
				dbox_key_check(function(ret){
					if(ret == 200)
					{
						console.log("Key worked");
						pu.style.display = "inline";
						pu.style.visibility = 'visible';
						lo.value = "Logout";
						dbox_create_folder(BMARK_PATH, function(ret){
							if(ret != 200)
							{
								console.log("error creating" + BMARK_PATH)
							}
						});
						dbox_create_folder(NOTE_PATH);
						dbox_create_folder(INTERNAL_PATH);
					}
					else
					{
						console.log("Key NOT working");
						pu.style.display = "none";
						pu.style.visibility = 'hidden';
						lo.value = "Login to Dropbox";
						
					}
					
				})
			}
			
			//LOAD FILE TO TEXT AREA
			//TODO if only exists in cache, load cache
			//if exists in both remote/local, load whichever has more recent timestamp
			//if only exists in the remote, load remote
			//if exists in neither, check if it exists in external dbox directory
			//if only exists in extern dbox, load it and mark the caches with metadata indicating when we branched from mainline (so that we can alert to overwriting saves)
			//if nothing found, just create it as a new file in remote cache and alert to any name conflicts upon saving
		
			if(lo.value == "Logout")
			{
				//dbox_does_file_exist(remote_cache)
				//does_does_file_exist(remote_main)
				//check timestamps on all files to if 
			}
		
		}
		
		function dbox_revoke_key(callback)
		{
		    var xhr = new XMLHttpRequest();
		    xhr.open('POST', 'https://api.dropboxapi.com/2/auth/token/revoke', true);
		    xhr.setRequestHeader('Authorization', 'Bearer ' + dbox_key_value);

		    xhr.onreadystatechange = function (){
				console.log("Revoke" + xhr.status)
		        if (xhr.readyState == 4) {
					callback(xhr.status);
		        }
		    }   
			
		    xhr.send();
		}
		
		
		// Example POST method implementation:
		async function postData(url = '', data = {}) {
		  // Default options are marked with *
		  const response = await fetch(url, {
		    method: 'POST', // *GET, POST, PUT, DELETE, etc.
		    mode: 'cors', // no-cors, *cors, same-origin
		    cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
		    credentials: 'same-origin', // include, *same-origin, omit
		    headers: {
		      'Content-Type': 'application/json'
		      // 'Content-Type': 'application/x-www-form-urlencoded',
		    },
		    redirect: 'follow', // manual, *follow, error
		    referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
		    body: JSON.stringify(data) // body data type must match "Content-Type" header
		  });
		  return response.json(); // parses JSON response into native JavaScript objects
		}
		
		function dbox_key_check(callback)
		{
			console.log("Account_id=" + dbox_account_id);
			
			dbox_account_id = localStorage.getItem("dbox_account_id");
			
			console.log("Account_id=" + dbox_account_id);
			
		    var xhr = new XMLHttpRequest();
		    xhr.open('POST', 'https://api.dropboxapi.com/2/users/get_account', true);
		    xhr.setRequestHeader('Authorization', 'Bearer ' + dbox_key_value);
			xhr.setRequestHeader('Content-type', 'application/json');

		    xhr.onreadystatechange = function (){
				console.log("Check" + xhr.status)
		        if (xhr.readyState == 4) {
					callback(xhr.status);
		        }
		    }
			
			var data = JSON.stringify({"account_id":dbox_account_id});
			
		    xhr.send(data);
		}
		
		function dbox_key_check(callback)
		{
			console.log("Account_id=" + dbox_account_id);
			
			dbox_account_id = localStorage.getItem("dbox_account_id");
			
			console.log("Account_id=" + dbox_account_id);
				
			// fetch('http://soundcloud.com/oembed?url=http%3A//soundcloud.com/forss/flickermood&format=json&callback=')
			// 	.then(response => response.json())
			// 	.then(data => console.log(data))
		
			postData('https://api.dropboxapi.com/2/users/get_account', { account_id: dbox_account_id })
			  .then(data => {
			    console.log(data); // JSON data parsed by `data.json()` call
				
			  });
		  
	  	}

		function dbox_create_folder(path, callback)
		{
		    var xhr = new XMLHttpRequest();
		    xhr.open('POST', 'https://api.dropboxapi.com/2/files/create_folder_v2', true);
		    xhr.setRequestHeader('Authorization', 'Bearer ' + dbox_key_value);
		    xhr.setRequestHeader('Content-type', 'application/json');

		    xhr.onreadystatechange = function (){
				console.log("Create" + xhr.status)
		        if (xhr.readyState == 4) {
					callback(xhr.status);
		        }
		    }  

		    var data = JSON.stringify({"path":path});

		    xhr.send(data);
		}

        //
        // desc: demonstrates textarea line numbers using canvas paint
        // auth: nikola bozovic <nigerija@gmail>
        //
        var TextAreaLineNumbersWithCanvas = function()
        {
        var div = document.createElement('div');
        var cssTable = 'padding:0px 0px 0px 0px!important; margin:0px 0px 0px 0px!important; font-size:1px;line-height:0px; width:100%;';
              var cssTd1 = 'border:1px #345 solid; border-right:0px; vertical-align:top; width:1px;';
              var cssTd2 = 'border:1px #345 solid; border-left:0px; vertical-align:top;';
              var cssButton = 'width:120px; height:40px; border:1px solid #333 !important; border-bottom-color: #484!important; color:#ffe; background-color:#222;';
              var cssCanvas = 'border:0px; background-color:#1c1c20; margin-top:0px; padding-top:0px;';
              var cssTextArea =  'width:100%;'
                               + 'height:500px;'
                               + 'font-size:11px;'
                               + 'font-family:monospace;'
                               + 'line-height:15px;'
                               + 'font-weight:500;'
                               + 'margin: 0px 0px 0px 0px;'
                               + 'padding: 0px 0px 0px 0px;'
                               + 'resize: none;'
                               + 'color:#ffa;'
                               + 'border:0px;'
                               + 'background-color:#222;'
                               + 'white-space:nowrap; overflow:auto;'
                               // supported only in opera 12.x
                               + 'scrollbar-arrow-color: #ee8;'
                               + 'scrollbar-base-color: #444;'
                               + 'scrollbar-track-color: #666;'
                               + 'scrollbar-face-color: #444;'
                               + 'scrollbar-3dlight-color: #444;' /* outer light */
                               + 'scrollbar-highlight-color: #666;' /* inner light */
                               + 'scrollbar-darkshadow-color: #444;' /* outer dark */
                               + 'scrollbar-shadow-color: #222;' /* inner dark */
                               ;

              // LAYOUT (table 2 panels)
              var table = document.createElement('table');
                  table.setAttribute('cellspacing','0');
                  table.setAttribute('cellpadding','0');
                  table.setAttribute('style', cssTable);
              var tr = document.createElement('tr');
              var td1 = document.createElement('td');
                  td1.setAttribute('style', cssTd1);
              var td2 = document.createElement('td');
                  td2.setAttribute('style', cssTd2);
                  tr.appendChild(td1);
                  tr.appendChild(td2);
                  table.appendChild(tr);

              // TEXTAREA
              var ta = this.evalnode = document.createElement('textarea');
                  ta.setAttribute('cols','80');
                  ta.setAttribute('style', cssTextArea);
                  //ta.value = this.S.get('eval') || '';  // get previous executed value ;)

              // TEXTAREA NUMBERS (Canvas)
              var canvas = document.createElement('canvas');
                  canvas.width = 48;    // must not set width & height in css !!!
                  canvas.height = 500;  // must not set width & height in css !!!
                  canvas.setAttribute('style', cssCanvas);
                  ta.canvasLines = canvas;
                  td1.appendChild(canvas);
                  td2.appendChild(ta);
                  div.appendChild(table);

              // PAINT LINE NUMBERS
              ta.paintLineNumbers = function()
              {
                try
                {
                var canvas = this.canvasLines;
                if (canvas.height != this.clientHeight) canvas.height = this.clientHeight; // on resize
                var ctx = canvas.getContext("2d");
                ctx.fillStyle = "#303030";
                ctx.fillRect(0, 0, 42, this.scrollHeight+1);
                ctx.fillStyle = "#808080";
                ctx.font = "11px monospace"; // NOTICE: must match TextArea font-size(11px) and lineheight(15) !!!
                var startIndex = Math.floor(this.scrollTop / 15,0);
                var endIndex = startIndex + Math.ceil(this.clientHeight / 15,0);
                for (var i = startIndex; i < endIndex; i++)
                {
                  var ph = 10 - this.scrollTop + (i*15);
                  var text = ''+(1+i);  // line number
                  ctx.fillText(text,40-(text.length*6),ph);
                }
                }
                catch(e){ alert(e); }
              };
              ta.onscroll     = function(ev){ this.paintLineNumbers(); };
              ta.onmousedown  = function(ev){ this.mouseisdown = true; }
              ta.onmouseup    = function(ev){ this.mouseisdown=false; this.paintLineNumbers(); };
              ta.onmousemove  = function(ev){ if (this.mouseisdown) this.paintLineNumbers(); };

              ta.onchange  = function(ev){console.log("change"); save_loop();};

            document.body.appendChild(div);
            // make sure it's painted
            ta.paintLineNumbers();
            return ta;
        };
		
		function dbox_create_file(path, bin, overwrite, callback)
		{
	
		    var xhr = new XMLHttpRequest();
		    xhr.open('POST', 'https://content.dropboxapi.com/2/files/upload', true);
		    xhr.setRequestHeader('Authorization', 'Bearer ' + dbox_key_value);
		    xhr.setRequestHeader('Content-type', 'application/octet-stream');
	
			if(overwrite)
			{
			    xhr.setRequestHeader('Dropbox-API-Arg', JSON.stringify({"path":path, "autorename":false,"mode":{".tag":"overwrite"}, "mute":false})); 
			}
			else
			{
			    xhr.setRequestHeader('Dropbox-API-Arg', JSON.stringify({"path":path, "autorename":true,"mode":{".tag":"add"}, "mute":false})); 
			}

		    xhr.onreadystatechange = function (){
				console.log("Upload" + xhr.status)
		        if (xhr.readyState == 4) {
					callback(xhr.status);
		        }
		    }  
			
		    xhr.send(bin);
		}
		
		
		
		//depends on the folder already having been ls'd into not_file_ls element. We check to see if files exists before performing the cat
		// function dbox_cat_file(path, callback)
		// {
		// 	let match = 0;
		//
		//     if(note_file_ls != null)
		// 	{
		//
		// 		note_file_ls.forEach(function (item, index) {
		//
		// 			if(ti.value == item)
		// 			{
		// 			    var xhr = new XMLHttpRequest();
		// 			    xhr.open('POST', 'https://content.dropboxapi.com/2/files/download', true);
		// 			    xhr.setRequestHeader('Authorization', 'Bearer ' + dbox_key_value);
		// 			    xhr.setRequestHeader('Dropbox-API-Arg', JSON.stringify({"path":path}));
		//
		// 			    xhr.onreadystatechange = function () {
		//
		// 			        if (xhr.readyState == 4 && xhr.status == 200) {
		// 			  			callback(xhr.responseText);
		// 			        }
		// 					else
		// 					{
		// 					}
		// 			    }
		//
		// 			    xhr.send();
		// 			}
		//
		// 			if(ti.value != item && index==(note_file_ls.length - 1))
		// 			{
		// 				callback("");
		// 			}
		//
		// 		});
		// 	}
		// 	else
		// 	{
		// 		callback("");
		// 	}
		// }
		
				// di
		    	  // error_output.inne
		function note_save_handler()
		{
			let di = document.getElementById('di');
			let ti = document.getElementById('ti');
			let error_output = document.getElementById('error_op');
			
			console.log(di.value);
			console.log(ti.value);
			console.log(ta.value);
			
			save_loop();
			
		    if(ta.value == "")
		    {
				ta.placeholder = "Enter some text here before saving!";
			  	return;
		    }
	
		    if(ti.value == "")
		    {
				error_output.style.color = 'red';
			  	error_output.innerHTML = "Please specify a file name";
				
				ti.value = prompt("Please enter a file name", "");
				if (ti.value == "")
				{
			  		return;
				}
				  
				// $("#error_op").fadeIn();
			  	return;
		    }
  
		    // if( di.value != "")
		    // {
		    // 		  	  if(di.value.includes('\\') || di.value.includes('\/'))
		    // 		  	  {
		    // 		  		  error_output.style.color = 'red';
		    // 		  	  	  error_output.innerHTML = "Folder path cannot contain slashes";
		    // 				  // $("#error_op").fadeIn();
		    // 		  	  	  return;
		    // 		  	  }
		    // 		  	  else
		    // 		  	  {
		    // 		  	  	  error_output.innerHTML = "";
		    // 				  // $("#error_op").fadeOut();
		    // 		  	  }
		    //
		    // 		  	  dbox_create_folder(NOTE_PATH + di.value);
		    //
		    // }
  
		    ti.value = ti.value.replace(/–/g, '-');
		    di.value = di.value.replace(/–/g, '-');
  
		    if(ti.value.includes('\\') || ti.value.includes('\/'))
		    {
				error_output.style.color = 'red';
		    	error_output.innerHTML = "Please remove slashes from the name";
				// $("#error_op").fadeIn();
				return;
		    }
		    else
		    {
		    	  error_output.innerHTML = "";
				  // $("#error_op").fadeOut();
		    }	
	
		   	// if(di.value == "")
		   	// 		    {
				full_path_to_write = NOTE_PATH+ti.value+".txt";
		  	// }
		  	// else
		  	// {
		  	// 	full_path_to_write = NOTE_PATH+di.value+'\/'+ti.value+".txt";
		  	// }
				
			// let temp_text = ta.value;
			// let new_file_contents = file_contents + '\n' + temp_text;
			//
			// dbox_create_file(full_path_to_write, new_file_contents, /*overwrite*/1, function(){
			// 	sub_but.innerHTML = "Saved"
			// 		      	sub_but.style.background = '#65b4fb';
			// 		      	sub_but.style.opacity = 1;
			// 	already_saved = 1;
			//
			// 	ta.value = "";
			// 	background.loaded_file_name = ti.value;
			// 	background.loaded_file_dir = di.value;
			// 	show_ro_text_area(new_file_contents);
			//
			// 	$("#ro_text_area").highlight();
			//
			// 	background.note_change_occurred = 0;
			// 	background.most_recent_text_area_contents = "";
			// });

			dbox_create_file(full_path_to_write, ta.value, /*overwrite*/1, function(ret){
				if(ret == 200)
				{
					alert("Success");
				}
				else
				{
					alert("Failed. Data not backed up.");
				}
			});
		}
		
		function log()
		{
			let lo = document.getElementById('log');
			console.log(lo.value)
			
			save_loop();
			
			if(lo.value == "Login to Dropbox")
			{
				window.location.href = AUTH_URL;
			}
			else
			{
				let pu = document.getElementById('push');
				
				dbox_revoke_key(function(ret){
					if(ret == 200)
					{
						alert("Logout success");
						window.location.href = THISURL;
					}
					else
					{
						alert("Logout failed");
						window.location.href = THISURL;
					}
				});
				
				localStorage.removeItem("dbox_token");
				dbox_key_value = '';
				pu.style.display = "none";
				lo.value = "Login to Dropbox";
			}
		}
		var ta = TextAreaLineNumbersWithCanvas();
	</script>
		
	<inline>
    <!-- <button onclick="pull()">Pull Before</button>
	<button onclick="pull()">Pull After</button> -->
	<input id="push" type="button" onclick="note_save_handler()" value="Push">
	<input id="erase" type="button" onclick="erase()" value="Erase">
	<input id="log" type="button" onclick="log()" value="Login to Dropbox">
	<input type="text" class="form-control"  id="ti" list="user_folders" placeholder="Untitled" value="">
	<input type="text" class="form-control"  id="di" list="user_folders" placeholder="Folder (optional)" value="" style="display:none;">
	<span id="lia">Logged in as: </span id="un"></span>
	<!-- <div id="error_op" style="display:none;"></div> -->
	<div id="error_op"></div>
	</inline>
</body>

</html>
